\include{common}

\begin{document}
\begin{varwidth}{\linewidth}

\begin{algorithmic}
\Struct[Datagram]{ConnTrack}
\Field{Identifier}{identifier}
\Field{Header}{header}
\EndStruct
\end{algorithmic}

\begin{algorithmic}
\Function{handleDatagram}{datagram}
  \Switch{$datagram$}
    \Case{$ConnTrack$}
      \State $(version, counterpartyIdentifier, rootOfTrust, state) \gets$ \Call{Get}{identifier}
      \Assert{$state == OPEN$}
      \Switch{\Call{updateRootOfTrust}{rootOfTrust, header}}
        \Case{$newRootOfTrust$}
          \State \Call{Set}{identifier, (version, counterpartyIdentifier, newRootOfTrust, state)}
        \EndCase
        \Case{$error$}
          \State \Return $error$
        \EndCase
      \EndSwitch
    \EndCase
  \EndSwitch
\EndFunction
\end{algorithmic}

\end{varwidth}
\end{document}
